{
  "author": {
    "email": "brunosmmm@gmail.com",
    "name": "Bruno Morais"
  },
  "data": {
    "branch": "master",
    "content": "# Phase 5: MAC Peripheral Fixes \u2014 Complete\n\n## Commit\nb0994f6 \u2014 `feat(mac): Phase 5: MAC peripheral fixes`\n\n## What Was Done\n\n### 1. Accumulator Stale-Value Bug (`mac/accumulate.vhd`)\n- **Problem:** Signal assignments in VHDL processes are delayed by 1 delta cycle. The code computed `ACC_DATA_OUT <= sum`, then immediately read `ACC_DATA_OUT(N)` for carry and `DATA_OUT` for zero check \u2014 all seeing OLD values.\n- **Fix:** Replaced signal-based intermediate computation with process variables (`sum_u`, `sum_s`, `old_sig`) which evaluate immediately.\n- Removed obsolete `ACC_DATA_OUT` and `LAST_DATA_SIG` signals.\n\n### 2. CONFIG_MAC_IN Feedback Loop (`mac/mac.vhd:139`)\n- **Problem:** `CONFIG_MAC_IN <= (DATA & MASK) | (CONFIG_MAC_IN & ~MASK)` \u2014 self-referencing combinational loop.\n- **Fix:** Changed to read from `CONFIG_MAC_OUT` (the actual stored register value) for read-only bit preservation.\n\n### 3. Signed Overflow Detection (`mac/accumulate.vhd`)\n- **Problem:** Overflow check used stale `DATA_OUT(N-1)` (old result, not new sum) and `LAST_DATA_SIG` (assigned in same process, 1 delta late).\n- **Fix:** Simplified to `(DATA_IN sign = old_sign) AND (sum sign /= old_sign)` using process variable `old_sig` for old accumulator sign and `sum_s` for new result.\n\n## Session Summary (Phases 4 + 5 in this session)\n\n### Phase 4 (commit 237a338):\n- SLT signed comparison fix\n- SGT instruction added\n- Register bank SUBCK anti-pattern removed\n- 2 new tests (SLT/SGT signed)\n\n### Phase 5 (commit b0994f6):\n- Accumulator stale-value bug fixed\n- CONFIG_MAC_IN feedback loop fixed\n- Signed overflow detection fixed\n\n## Overall Progress\n- Phase 1: Critical pipeline fixes \u2014 DONE\n- Phase 2: Hazard unit completion \u2014 DONE\n- Phase 3: Forwarding coverage \u2014 DONE\n- Phase 4: ALU and register bank fixes \u2014 DONE\n- Phase 5: MAC peripheral fixes \u2014 DONE\n- Phase 6: Test infrastructure \u2014 DONE\n\nAll planned phases complete. 12 tests passing. Remaining items are edge cases (BZ flag timing) and MAC test coverage.\n",
    "context": "Completed Phase 5 (final planned phase) and committed",
    "repository_id": "github.com/brunosmmm/anem16pipe",
    "session_id": "20260206_011215_17b0",
    "session_type": "Software Development",
    "title": "Phase 5 Complete \u2014 MAC Peripheral Fixes"
  },
  "entity_id": "20260206_0305_phase-5-complete-mac-peripheral-fixes",
  "lamport_clock": 51,
  "operation_id": "op_20260206_030524_89db8b33",
  "operation_type": "checkpoint_save",
  "parent_operation": null,
  "timestamp": "2026-02-06T03:05:24.531183+00:00"
}